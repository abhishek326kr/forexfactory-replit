// This is your Prisma schema file
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(100)
  email       String    @unique @db.VarChar(100)
  username    String    @unique @db.VarChar(50)
  phone       String?   @db.VarChar(15)
  password    String    @db.VarChar(255)
  role        AdminRole @default(editor)
  createdAt   DateTime  @default(now()) @map("created_at")
  profilePic  String?   @map("profile_pic") @db.VarChar(255)
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at")

  @@map("admins")
}

model Blog {
  id            Int       @id @default(autoincrement())
  title         String    @db.VarChar(255)
  seoSlug       String    @map("seo_slug") @db.VarChar(255)
  status        BlogStatus
  views         Int?      @default(0)
  createdAt     DateTime  @default(now()) @map("created_at")
  content       String    @db.Text
  author        String    @db.VarChar(255)
  featuredImage String    @map("featured_image") @db.VarChar(255)
  tags          String    @db.VarChar(255)
  categoryId    Int       @map("category_id")
  downloadLink  String?   @map("download_link") @db.VarChar(255)

  categories    BlogCategory[]
  comments      Comment[]
  seoMeta       SeoMeta[]

  @@map("blogs")
}

model BlogCategory {
  blogId      Int @map("blog_id")
  categoryId  Int @map("category_id")

  blog        Blog     @relation(fields: [blogId], references: [id], onDelete: Cascade)
  category    Category @relation(fields: [categoryId], references: [categoryId], onDelete: Cascade)

  @@id([blogId, categoryId])
  @@map("blog_categories")
}

model Category {
  categoryId  Int      @id @default(autoincrement()) @map("category_id")
  name        String   @unique @db.VarChar(255)
  description String?  @db.Text
  status      CategoryStatus? @default(active)

  blogs       BlogCategory[]

  @@map("categories")
}

model Comment {
  id        Int      @id @default(autoincrement())
  postId    Int      @map("post_id")
  name      String   @db.VarChar(255)
  email     String   @db.VarChar(255)
  comment   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  blog      Blog     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("comments")
}

model Media {
  id         Int      @id @default(autoincrement())
  fileName   String   @map("file_name") @db.VarChar(255)
  filePath   String   @map("file_path") @db.VarChar(255)
  uploadedBy Int      @map("uploaded_by")
  uploadedAt DateTime @default(now()) @map("uploaded_at")

  user       User     @relation(fields: [uploadedBy], references: [id], onDelete: Cascade)

  @@map("media")
}

model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  token     String   @db.VarChar(64)
  expiresAt DateTime @map("expires_at")
  used      Int?     @default(0)
  createdAt DateTime? @default(now()) @map("created_at")

  @@map("password_reset_tokens")
}

model Post {
  id               Int       @id @default(autoincrement())
  title            String    @db.VarChar(255)
  slug             String    @unique @db.VarChar(255)
  content          String    @db.Text
  image            String?   @db.VarChar(255)
  authorId         Int       @map("author_id")
  category         String?   @db.VarChar(100)
  featuredImage    String?   @map("featured_image") @db.VarChar(255)
  status           PostStatus? @default(draft)
  metaTitle        String?   @map("meta_title") @db.VarChar(255)
  metaDescription  String?   @map("meta_description") @db.Text
  metaKeywords     String?   @map("meta_keywords") @db.Text
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at")

  author           User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@map("posts")
}

model SeoMeta {
  id              Int       @id @default(autoincrement())
  postId          Int       @map("post_id")
  seoTitle        String?   @map("seo_title") @db.VarChar(255)
  seoDescription  String?   @map("seo_description") @db.Text
  seoKeywords     String?   @map("seo_keywords") @db.Text
  seoSlug         String?   @map("seo_slug") @db.VarChar(255)
  canonicalUrl    String?   @map("canonical_url") @db.VarChar(255)
  metaRobots      MetaRobots? @default(index_follow) @map("meta_robots")
  ogTitle         String?   @map("og_title") @db.VarChar(255)
  ogDescription   String?   @map("og_description") @db.Text
  ogImage         String?   @map("og_image") @db.VarChar(255)
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @default(now()) @updatedAt @map("updated_at")

  blog            Blog      @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("seo_meta")
}

model Signal {
  id          Int      @id @default(autoincrement())
  uuid        String   @db.VarChar(32)
  title       String   @db.VarChar(255)
  description String   @db.Text
  filePath    String   @map("file_path") @db.VarChar(500)
  mime        String   @db.VarChar(100)
  sizeBytes   Int      @map("size_bytes")
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([createdAt], name: "created_at_idx")
  @@map("signals")
}

model User {
  id          Int       @id @default(autoincrement())
  email       String    @unique @db.VarChar(100)
  password    String    @db.VarChar(255)
  role        UserRole  @default(viewer)
  createdAt   DateTime  @default(now()) @map("created_at")
  phone       String?   @db.VarChar(20)
  name        String?   @db.VarChar(255)
  countryCode String?   @default("+91") @map("country_code") @db.VarChar(10)
  country     String?   @default("IN") @db.VarChar(50)

  posts       Post[]
  media       Media[]

  @@map("users")
}

// Enums
enum AdminRole {
  admin
  editor
}

enum BlogStatus {
  published
  draft
}

enum CategoryStatus {
  active
  inactive
}

enum PostStatus {
  draft
  published
}

enum MetaRobots {
  index_follow       @map("index, follow")
  noindex_follow     @map("noindex, follow")
  index_nofollow     @map("index, nofollow")
  noindex_nofollow   @map("noindex, nofollow")
}

enum UserRole {
  admin
  editor
  viewer
}